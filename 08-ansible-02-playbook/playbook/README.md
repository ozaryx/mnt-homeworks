# Настройка инфраструктуры Clickhouse+Vector

Плейбук служит для установки и настроки инфрастуктуры сбора журналов работы наблюдаемой системы.

Плейбук содержит 4 плея:

1. Настройка репозиториев YUM. Тег fix_repos
1. Установка ПО и настройка сервера БД Clickhouse. Тег install_clickhouse
1. Установка ПО Vector. Тег install_vector
1. Настройка ПО Vector. Тег config_vector

## Инвентори

Инвентори содержит две группы хостов: clickhouse и vector. В которых зарегистрировано по одному хосту. Способ подключения docker.

## Настройки групп хостов

Основные параметры для групп хостов - версия ПО, список устанавливаемых пакетов, пути установки и настройки ПО, конфигурация сервиса.

### Настройки Clickhouse

* clickhouse_version - версия Clickhouse
* clickhouse_packages - список пакетов для установки (clickhouse-client, clickhouse-server, clickhouse-common-static)

### Настройки Vector

* vector_version - версия Vector
* vector_config_dir - каталог файла настроек
* vector_config - параметры конфигурации в формате yaml

## Применение

Запуск плейбука выполняется командой

`ansible-playbook -i inventory/prod.yml site.yml`

Для упрощения подготовки и настройки инфраструктуры создано несколько sh скриптов:

* init.sh - подготовка docker контейнеров
* deploy.sh - прогон плейбука для установки и настройки стека Clickhouse+Vector
* destroy.sh - удаление docker контейнеров

Для проверки достпуности хостов (контейнеров) создан плейбук test.yml, который выполняет запуск модуля ping для проверки доступности хостов.
